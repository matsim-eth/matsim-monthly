language: java
jdk: oraclejdk8
addons:
  apt:
    packages:
      - oracle-java8-installer    # https://github.com/travis-ci/travis-ci/issues/3259
script:
  - git clone --depth 1 https://github.com/matsim-org/matsim.git
  - bash prepare.sh
  - [ $SKIP_BUILD -eq 43 ] || (cd $TRAVIS_BUILD_DIR/matsim && mvn install -B -Dmaven.test.redirectTestOutputToFile -Dmatsim.preferLocalDtds=true --fail-at-end)
  - [ $SKIP_BUILD -eq 43 ] || (cd $TRAVIS_BUILD_DIR/matsim/matsim && mvn deploy -B -DskipTests=true --settings=$TRAVIS_BUILD_DIR/settings.xml)
  - [ $SKIP_BUILD -eq 43 ] || (cd $TRAVIS_BUILD_DIR/matsim/contribs && mvn deploy -B -DskipTests=true --settings=$TRAVIS_BUILD_DIR/settings.xml)
  - [ $SKIP_BUILD -eq 43 ] || (curl --user $BINTRAY_USER:$BINTRAY_PASSWORD -X POST https://api.bintray.com/content/matsim-eth/matsim/matsim/`cat version.txt`/publish)
cache:
  directories:
  - $HOME/.m2
